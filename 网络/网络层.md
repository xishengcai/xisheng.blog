![null](https://img.bosszhipin.com/beijin/cms/e982398cf054ede9c532a78c1211a103.png)

# 网络协议实战教程，看这一篇，面试无忧！

作者 程序员小谭





大家好，我是小谭。

说起网络协议，我相信N多N多测试小伙伴都hold不住它，也有很多学习软件测试的初学者，倒在了它的面前。如果你不是计算机科班出身，或者你是科班出身，但在大学里，没有好好学习，那么，你大概率会折戟沉沙……

在本期项目实战中，我将**尽可能的、最大限度的、用通俗易懂的语言**讲解网络协议；同时，我也会搭配上手操作，助你加深印象。

怎么说呢，骗个关注，不过分吧？

## TCP/IP协议理论

### 1. TCP/IP协议是一大堆协议的集合

比如熟悉的TCP（传输控制协议）、IP（网际协议）、HTTP（超文本传输协议）、HTTPS（安全的 HTTP）、SSL（安全套接字层）、SMTP（简易邮件传输协议）、FTP（文件传输协议）、NTP（网络时间协议）等等。

只不过，因为TCP、IP协议是两个很重要的协议，故用他俩命名了。

### 2. TCP/IP协议分为四层

即，数据传输一次主要经历以下4个步骤，从上到下为：**应用层，传输层，网络层，链路层。**

还有一种是教科书里常见的的OSI七层模型。

作为测试，**无需过多关心七层OSI模型，掌握TCP/IP的四层即可。**

## TCP/IP协议实战

访问程序员小谭的官网testtalking.com，并用Wireshark软件（自行下载并安装）抓包。

![image-20220107094317842](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf6591870efcf73d5b0dc642ce6b02caa06ceffa221919138669556f2f62fc5233ba49e1.jpg)

看图，和下面的理论做对应理解。

### 1. 应用层

**作用**：**定义数据格式并按照对应的格式解读数据。**

**操作**：选中Wireshark抓的包，展开`Hypertext Transfer Protocol`。我们能看到

，应用层定义了HTTP协议来规范数据格式，定义了请求数据格式为`Accept`，当对方接收到请求后，就知道该用什么格式来解析和处理。

![image-20210527154039389](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf65918783bf7bbb5d5c134779da4446283e8a36221919138669556f2f62fc5233ba49e1.jpg)

**理解**：你想白嫖程序员小谭的项目，我给了规则——必须关注我。那么，你就必须要关注我。

### 2、传输层

**作用**：**定义端口，标识应用程序身份，实现端口到端口的通信**。

**操作**：展开`Transmission Control Protocol``﻿`

。我们可以看到，TCP协议定义了80端口，当数据包到达主机（testtalking服务器）以后，就可以根据端口号找到对应的应用。

![image-20210527154805873](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf6591871288a241f7a5a7f8e6efedff6f0aa56a221919138669556f2f62fc5233ba49e1.jpg)

**理解**：你要关注程序员小谭。但我有程序员小谭、小谭测试、测小谭试几个号，可不能关注错了。

另外，这里还涉及到一道高频面试题：TCP和UDP的区别。

他俩，最主要的区别就在传输层。UDP协议没有确认机制，数据包一旦发出，无法知道对方是否收到，可靠性差；TCP协议可以简单理解为有确认机制的UDP协议，即每发出一个数据包都要求确认，如果有一个数据包丢失，就收不到确认，发送方就必须重发这个数据包。

理解：UDP——你点了关注，但并不知道真的关注上了没；TCP——你点了关注，OK，小谭确认了你的眼神。

tips：请记住TCP的这个特点，下一篇文章会用到！

### 3、网络层

**作用**：**定义网络地址、区分网段、子网内MAC寻址、对于不同子网的数据包进行路由。**

**操作**：展开`Internet Protocol`。

这个简单，IP协议定义了地址，告诉你数据要传输到哪个目的地（IP为121.5.121.205的testtalking的服务器）。

![image-20210527154745506](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf6591871c8957740fd054b1f02e0d06bb848743221919138669556f2f62fc5233ba49e1.jpg)

**理解**：关注了程序员小谭，你和小谭勾搭上了。

### 4、链路层

**作用**：**对电信号进行分组并形成数据帧，并以广播的形式通过物理介质发送给接收方。**

**操作**：展开`Ethernet`。我们可以看到，网卡`Ethernet`地址就是数据包的发送MAC地址（Src：本机电脑）和接收MAC地址（Dst：testtalking服务器）。

有了地址以后，以太网采用广播形式，把数据包发给接

收方。接收方会读取目标MAC地址（Source），并和自己的MAC地址进行对比。如果相同就

做下一步处理；如果不同，就丢弃这个包。

![image-20210527154738951](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf659187b7cb394b3836d52591db988d7aaaed67221919138669556f2f62fc5233ba49e1.jpg)

没了。

四层协议，就是这么简单！再附送一张让你脑壳疼的分层图。

tips：看看就好~

![750327-20160822164857776-669486844 - 副本](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf6591872af488004591cbc12cd82c44518523de221919138669556f2f62fc5233ba49e1.jpg)

## 三次握手和四次挥手理论

说起测试工程师的面试，有一道经典题——什么是（为什么要）三次握手和四次挥手。

曾几何时，我也为这道题折过腰。但时过境迁，现在再来讲解它，so easy~

首先，我们从现实生活中理解：

1、握手：同他人建立关系；

2、挥手：拜拜了，您勒。

其次，再从理论层面理解：

1、三次握手：**建立可靠的连接**。使双方能确认自己与对方的发送与接收功能正常。

2、四次挥手：**断开连接**。但是，握手了三次，为什么要挥手四次呢？这块搭配下面的实战更好理解，所以我先卖个关子，不跟大家讲太多。

## 三次握手实战

访问testtalking.com网站，用Wireshark抓首页的GET请求，然后点击鼠标右键，追踪TCP流。

筛选命令：http.request.method==GET && ip.dst==121.5.121.205

121.5.121.205 是testtalking.com服务器的ip

![image-20220106114038215](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf6591871b1bda991e2d43ab092e87cd5620cf71221919138669556f2f62fc5233ba49e1.jpg)

追踪后，你可以对照着我的图片，查看到三次握手和四次挥手的记录。

![image-20220106112138996](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf659187705034a394ff09632ae70db70a6542c8221919138669556f2f62fc5233ba49e1.jpg)



![image-20220106150211012](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf659187fd9a6825d977f80b69502fc87723aa7d221919138669556f2f62fc5233ba49e1.jpg)

①source指报文发起方

②121.5.121.205是testtalking.com服务器的ip，打码的xxxx.238是我本机电脑的ip。

上文我们说道，TCP在收发数据前，必须和对方建立可靠的连接。建立稳定的TCP连接，需要三次握手，即，

1. 读者：小谭，你听得到么？我想给你三连点赞。
2. 小谭：我听到你的承诺了，说话算数！
3. 读者：小谭，我要三连点赞了。

### 1、第一次握手

读者：小谭，你听得到么？我想给你三连点赞。

![image-20220106112512732](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf6591879cd3baa134cd98773bc45a9a310787a7221919138669556f2f62fc5233ba49e1.jpg)

建立连接时，客户端（你的浏览器）发送 `SYN` 报文到服务器（testtalking），等待服务器确认。

SYN：同步序列编号`Synchronize Sequence Numbers`的简写

客户端向服务器发送连接请求包时：

①将`SYN` Set为1

②发送序号 `Seq` (Sequence number)为0

### 2、第二次握手

小谭：我听到你的承诺了，说话算数！

![image-20220106112736880](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf659187269b0cc84280f9b9a5ff750e1efc231c221919138669556f2f62fc5233ba49e1.jpg)

服务器收到客户端发过来的报文，并且因为`SYN`=1，服务器知道客户端想建立连接，于是开始处理：

①服务器设置确认序号`ACK`为1

ACK：确认序号`Acknowledgement Number`的简写。

`ACK`是如何计算的？ACK = Seq（第一次握手的Seq值）+1 = 0+1 =1

②设置`SYN`为1

③将该TCP报文（发送序号`Seq`=0）发送给客户端。

### 3、第三次握手

读者：小谭，我要三连点赞了。

![image-20220106113218125](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf6591871a91fc21fccac33580729712c473949d221919138669556f2f62fc5233ba49e1.jpg)

客户端收到服务器的`SYN`+`ACK`包，也会给服务器发送一个确认序号`ACK`，发送后，客户端和服务器TCP连接成功，完成三次握手。

ACK = 发送序号Seq（第二次握手的）+1 = 0+1 =1

### 综上所述

一个完整的三次握手为：客户端请求（SYN）-> 服务器应答（SYN+ACK）-> 客户端确认（SYN）。完成三次握手，客户端与服务器开始传送数据。

嗯嘛，你可以给本文点赞了~

此时，你再看这张网图，是不是能看懂了？

![image-20210617111355601](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf6591877a481b73ecc4d4c0f26b02c805fe0930221919138669556f2f62fc5233ba49e1.jpg)

## 四次挥手实战

TCP建立连接要三次握手，但断开连接为什么要多一次呢？

说得简单点：**告别是双向的，且谁都可以发起，并且对方要确认**。A告诉B，B确认，B再告诉A，A确认，一共四次。

以本次实战举例，挥手阶段，服务器是首次发起方。即，

1. 小谭：朋友们，下篇文章再见。
2. 读者：好的。
3. 读者：小谭，下篇文章我们继续点赞。
4. 小谭：好的。

### 1、第一次挥手

小谭：朋友们，下篇文章再见。

![image-20220106150828128](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf6591870093171ff26041891e106c8807ba70cc221919138669556f2f62fc5233ba49e1.jpg)

服务器（testtalking）给客户端（你的浏览器）发送TCP包，用来关闭服务器到客户端的数据传送，即，

①将`FIN`和`ACK`置为1

FIN：Finish的简称。代表要关闭连接。

②发送序号`Seq`为482（你的可能不是482，对照着看）

③确认序号`Ack`为803（同上）

### 2、第二次挥手

读者：好的。

![image-20220106153126504](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf659187b2b296a0f8e6124fcdfbbe10aee71847221919138669556f2f62fc5233ba49e1.jpg)

客户端收到服务器的FIN后，会做确认：

①发回一个`ACK`，置为1

②发送序号`Seq` = 803（为收到的第一次挥手确认序号Ack）

③确认序号`Ack`= 483（为收到的第一次挥手发送序号+1=482+1=483）

### 3、第三次挥手

读者：小谭，下篇文章我们继续点赞。

![image-20220106153446249](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf6591877703cc59ddf82e1cceee1deb2cd558bc221919138669556f2f62fc5233ba49e1.jpg)

客户端（你的浏览器）给服务器（testtalking）发送TCP包，用来关闭客户端到服务器的数据传送。

①发送一个`FIN`和`ACK`，置为1

②发送序号`Seq` = 803（你的可能不是803，对照着看）

③确认序号`Ack` = 483（为收到第一次挥手发送序号+1=482+1=483）

### 4、第四次挥手

小谭：好的。

![image-20220106153853181](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf65918727ea885b472c11f88bf30703e6f1b09f221919138669556f2f62fc5233ba49e1.jpg)

服务器收到客户端发送的FIN之后，

①发回一个`ACK`，置为1

②发送序号`Seq` = 483 （为收到的第一次挥手发送序号Seq+1=482+1=483）

③确认序号`Ack`=804（为收到的第三次挥手的发送序号Seq+1=803+1=804）

### 综上所述

一个完整的四次握手为：A请求断开（FIN+ACK）-> B应答（ACK）-> B请求断开（FIN+ACK）-> A应答（ACK）。完成四次挥手后，客户端与服务器断开连接。

此时，你再看这张网图，是不是能看懂了？

![image-20210617111736265](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf659187afbba013abe8fbd2721747d0dad657b4221919138669556f2f62fc5233ba49e1.jpg)

## 三次握手和四次挥手总结

TCP为什么要三次握手和四次挥手？

标准答案：TCP是面向连接的通信方式， 采取此方式能大大提高数据通信的可靠性，使发送数据端和接收端在数据正式传输前就有了连接， 为数据正式传输打下了可靠的基础。

个人理解答案：

三次握手：A说我来了。B说你来吧。A说那我来了。

四次挥手：A说我走了。B说你走吧。B说我也走了，A说你走吧。

## HTTP和HTTPS

原计划，我本来打算写写HTTP和HTTPS，但后面我发现没多大必要。

一是因为HTTP的知识点比较简单，你去网上随便搜一两篇文章就能入个门；二是这块不好写实操教程，要掌握它们，就一条路：

1. 先自己看知识点
2. 跟着知识点，访问一个http://的网页和一个https://的网页，研究研究
3. 再回去看一遍知识点

所以，掌握HTTP和HTTPS的关键便成了——去哪儿看知识点，看什么样的知识点。

网上虽有文章和视频，但我更推荐你看一本书——《图解HTTP》。

此书带配图，言简易懂，并且，书中的重点内容，书中哪部分在工作中用得较多，我也勾选了出来。

你按照我勾选的内容，做重点掌握和理解，准没错！

![image-20220118105328069](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf6591877c451e4bdd49104e7aa5cad3d78574c1221919138669556f2f62fc5233ba49e1.jpg)



![image-20220118105109078](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf659187c3165766cc689466e0f5c30cfd899e86221919138669556f2f62fc5233ba49e1.jpg)



![image-20220118105146454](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf659187218891cfb6c45d62aa2504e4847acab7221919138669556f2f62fc5233ba49e1.jpg)



![image-20220118105207988](https://img.bosszhipin.com/beijin/upload/get/20220128/4558a342cf6591870c0e590bbad9581530f55445a5ed9071221919138669556f2f62fc5233ba49e1.jpg)

**对了，这本书有电子档，不想买实体书的小伙伴，可联系我获取。**